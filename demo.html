<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Awww - Audio Warpin' Web Widgets</title>
    
    <script src="awww.js"></script>

  </head>

  <body>

    <div id="widgets">

        <!--
          Custom elements cannot be self-closing
          https://developers.google.com/web/fundamentals/web-components/customelements
        -->

        <h4>Knob</h4>

        <a-knob
            minvalue="0"
            maxvalue="2.0"
            oninput="demo_log(this.value.toFixed(2))">
        </a-knob>

        <hr>

        <h4>Resize Handle</h4>

        <div id="resize-container">

            <a-resize
                minwidth="200"
                minheight="100"
                maxscale="2"
                keepaspectratio="true"
                graphic="dots"
                oninput="aResizeListener.call(this)">
            </a-resize>
        
        </div>

    </div>

    <pre id="log"></pre>


    <!-- Event listeners -->

    <script>

    function aResizeListener() {
        const style = this.parentNode.style;
        style.width = this.value.width + 'px';
        style.height = this.value.height + 'px';
        demo_log(this.value.width + 'x' + this.value.height);
    }

    </script>


    <!--
      Placing a stylesheet here is non-standard but works on most browsers.
      It is done this way purely to avoid polluting the top part of demo source.
     -->

    <style>

      body {
        background: #000;
        color: #fff;
        user-select: none;
        -webkit-user-select: none;
      }

      hr {
        opacity: 0.25;
      }

      #widgets {
        margin: 0 20px;
        font-family: sans-serif;
      }

      #log {
        position: fixed;
        bottom: 0;
        width: 100%;
        text-align: center;
        font-size: 2rem;
      }

      #resize-container {
        box-sizing: border-box; /* make <a-resize> behave in a predictable way */
        position: relative;     /* support <a-resize> position:absolute */; 
        border-radius: 5px;
        background: #555;
        width: 300px;
        height: 150px;
      }

      a-knob {
        width: 74px;
        height: 74px;
      }

      a-resize {
        width: 37px;
        height: 37px;
      }

      a-resize path {
        fill: #000;   /* dots version */
      }

      a-resize line {
        stroke: #000; /* lines version */
      }

    </style>

    <script>

    window.demo_log = (text) => document.getElementById('log').innerText = text;

    const widgets = [...document.getElementById('widgets').querySelectorAll('*')]
                        .filter(el => el.nodeName.startsWith('A-'));

    for (const widget of widgets) {

        const isDirectChild = widget.parentNode.id == 'widgets';
        const container = isDirectChild ? widget.parentNode : widget.parentNode.parentNode;
        const insertPointElem = isDirectChild ? widget : widget.parentNode;

        // Insert widget HTML before each widget

        const widgetClone = widget.cloneNode();
        widgetClone.removeAttribute('style');
        const preWithHtml = document.createElement('pre');
        preWithHtml.innerText = widgetClone.outerHTML;
        container.insertBefore(preWithHtml, insertPointElem);

        // Insert widget callback code before each widget

        const listener = widget.nodeName.split('-').map((s, i) => {
            return i > 0 ? s[0] + s.slice(1).toLowerCase() : s[0].toLowerCase();
        }).join('') + 'Listener'; // <a-knob> -> aKnobListener

        if (listener in window) {
            const preWithJs = document.createElement('pre');
            preWithJs.innerText = window[listener];
            container.insertBefore(preWithJs, insertPointElem);
        }

    }

    </script>


  </body>

</html>
