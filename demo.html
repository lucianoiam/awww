<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Awww - Audio Warpin' Web Widgets</title>
    
    <script src="awww.js"></script>

  </head>

  <body>

    <div id="widgets">

        <!--
          Custom elements cannot be self-closing
          https://developers.google.com/web/fundamentals/web-components/customelements
        -->

        <h4>Knob</h4>

        <!-- TODO: Allow to set range with min and max attributes -->
        <a-knob oninput="demo_log(this.value.toFixed(2))"></a-knob>

        <hr>
        <h4>Resize Handle</h4>

        <div id="resize-container">

            <a-resize oninput="aResizeListener.call(this)"></a-resize>
        
        </div>

    </div>

    <pre id="log"></pre>


    <!-- TODO: remove this after allowing to configure the resize handle using attributes -->
    <script>
    document.querySelector('a-resize').opt = {minWidth: 100, minHeight: 100, maxWidth: 600, maxHeight: 300};
    </script>


    <!-- Event listeners -->

    <script>

    function aResizeListener() {
        const style = this.parentNode.style;
        style.width = this.value.width + 'px';
        style.height = this.value.height + 'px';
        demo_log(this.value.width + 'x' + this.value.height);
    }

    </script>


    <!--
      Placing a stylesheet here is non-standard but works on most browsers.
      It is done this way purely to avoid polluting the top part of demo source.
     -->

    <style>

      body {
        background: #000;
        color: #fff;
        user-select: none;
        -webkit-user-select: none;
      }

      hr {
        opacity: 0.25;
      }

      #widgets {
        margin: 0 20px;
        font-family: sans-serif;
      }

      #log {
        position: fixed;
        bottom: 0;
        width: 100%;
        text-align: center;
        font-size: 2rem;
      }

      #resize-container {
        box-sizing: border-box; /* make <a-resize> behave in a predictable way */
        position: relative;     /* support <a-resize> position:absolute */; 
        background: #555;
        width: 200px;
        height: 100px;
      }

      a-knob {
        width: 50px;
        height: 50px;
      }

    </style>

    <script>

    window.demo_log = (text) => document.getElementById('log').innerText = text;

    [...document.getElementById('widgets').querySelectorAll('*')].forEach((el) => {

        if (!el.nodeName.startsWith('A-')) {
            return;
        }

        const isChildOfWidgets = el.parentNode.id == 'widgets';
        const widgets = isChildOfWidgets ? el.parentNode : el.parentNode.parentNode;
        const insertPointElem = isChildOfWidgets ? el : el.parentNode;

        // Insert widget HTML after each widget

        const elClone = el.cloneNode();
        elClone.removeAttribute('style');
        const preWithHtml = document.createElement('pre');
        preWithHtml.innerText = elClone.outerHTML;
        widgets.insertBefore(preWithHtml, insertPointElem);

        // Insert widget callback code after each widget

        const listener = el.nodeName.split('-').map((s, i) => {
            return i > 0 ? s[0] + s.slice(1).toLowerCase() : s[0].toLowerCase();
        }).join('') + 'Listener'; // <a-knob> -> aKnobListener

        if (listener in window) {
            const preWithJs = document.createElement('pre');
            preWithJs.innerText = window[listener];
            widgets.insertBefore(preWithJs, insertPointElem);
        }

    });

    </script>


  </body>

</html>
