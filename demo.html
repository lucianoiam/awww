<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Audio Warpin' Web Widgets</title>
    
    <script src="awww.js"></script>

    <style>

    a-knob {
        width: 74px;
        height: 74px;
    }

    a-resize {
        width: 37px;
        height: 37px;
    }

    a-resize path {
        fill: #000;
    }

    </style>

  </head>

  <body>

    <h2><a href="https://github.com/lucianoiam/awww" target="_blank">Awww</a></h2>

    <hr>

    <div id="widgets">

        <!--
          Custom elements cannot be self-closing
          https://developers.google.com/web/fundamentals/web-components/customelements
        -->

        <h4>Knob</h4>

        <a-knob
            minvalue="0"
            maxvalue="2.0"
            oninput="toast(this.value.toFixed(2))">
        </a-knob>

        <hr>

        <h4>Resize Handle</h4>

        <div id="resize-container">

            <a-resize
                minwidth="200"
                minheight="100"
                maxscale="2"
                keepaspectratio="true"
                graphic="dots"
                oninput="aResizeListener.call(this)">
            </a-resize>
        
        </div>

    </div>

    <pre id="log"></pre>


    <!-- Event listeners -->

    <script>

    function aResizeListener() {
        const style = this.parentNode.style;
        style.width = this.value.width + 'px';
        style.height = this.value.height + 'px';
        toast(Math.round(this.value.width) + 'x' + Math.round(this.value.height));
    }

    </script>


    <!-- END OF RELEVANT DEMO SOURCE -->

    <!--
      Placing a stylesheet here is non-standard but works on most browsers.
      It is done this way purely for keeping the interesting demo parts on top.
     -->

    <style>

    body {
        background: #000;
        color: #fff;
        font-family: sans-serif;
        margin: 0 20px;
        user-select: none;
        -webkit-user-select: none;
    }

    a {
        color: #fff;
    }

    pre {
        white-space: pre-wrap;
    }

    hr {
        opacity: 0.25;
    }

    a-resize line {
        stroke: #000; /* lines version */
    }

    #log {
        background-color: rgba(0, 0, 0, 0.75);
        position: fixed;
        top: 0;
        left: 50%;
        transform: translate(-50%, 0);
        height: 3rem;
        font-size: 3rem;
        padding: 10px;
        margin: 0;
        border-radius: 5px;
        visibility: hidden;
    }

    #resize-container {
        box-sizing: border-box; /* make <a-resize> behave in a predictable way */
        position: relative;     /* support <a-resize> position:absolute */; 
        border-radius: 5px;
        background: #555;
        width: 300px;
        height: 150px;
    }

    </style>

    <script>

    const widgets = [...document.getElementById('widgets').querySelectorAll('*')]
                        .filter(el => el.nodeName.startsWith('A-'));

    for (const widget of widgets) {

        const isDirectChild = widget.parentNode.id == 'widgets';
        const container = isDirectChild ? widget.parentNode : widget.parentNode.parentNode;
        const insertPointElem = isDirectChild ? widget : widget.parentNode;

        // Insert widget HTML before each widget

        const widgetClone = widget.cloneNode();
        widgetClone.removeAttribute('style');
        const preWithHtml = document.createElement('pre');
        preWithHtml.innerText = widgetClone.outerHTML;
        container.insertBefore(preWithHtml, insertPointElem);

        // Insert widget callback code before each widget

        const listener = widget.nodeName.split('-').map((s, i) => {
            return i > 0 ? s[0] + s.slice(1).toLowerCase() : s[0].toLowerCase();
        }).join('') + 'Listener'; // <a-knob> -> aKnobListener

        if (listener in window) {
            const preWithJs = document.createElement('pre');
            preWithJs.innerText = window[listener];
            container.insertBefore(preWithJs, insertPointElem);
        }

    }

    let toastTimeout = null;

    function toast(text) {
        if (toastTimeout) {
            clearTimeout(toastTimeout);
        }

        const log = document.getElementById('log');

        log.innerText = text;
        log.style.visibility = 'visible';
        
        toastTimeout = setTimeout(() => log.style.visibility = 'hidden', 1000);
    }

    </script>

  </body>

</html>
